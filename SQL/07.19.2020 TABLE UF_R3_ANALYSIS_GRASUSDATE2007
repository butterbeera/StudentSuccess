CREATE TABLE UF_R3_MAJORMINOR AS(

select 
distinct
A.PERSON_SID,
A.ACAD_PROG,
A.ACAD_PLAN,
B.ACAD_PLAN_TYPE_LD
(SELECT MAX(B_ED.PROG_STATUS_SID) 
	FROM UF_F_CPPS B_ED 
		WHERE A.PERSON_SID = B_ED.PERSON_SID                
     		  AND A.ACAD_PLAN = B_ED.ACAD_PLAN) as MAXSTATUS,
(SELECT MAX(B_ED.EFFDT_SID) 
	FROM UF_F_CPPS B_ED 
		WHERE A.PERSON_SID = B_ED.PERSON_SID                
     		  AND A.ACAD_PLAN = B_ED.ACAD_PLAN) as MAXEFF,
(SELECT MIN(B_ED.EFFDT_SID) 
	FROM UF_F_CPPS B_ED 
		WHERE A.PERSON_SID = B_ED.PERSON_SID                
     		  AND A.ACAD_PLAN = B_ED.ACAD_PLAN) AS MINEFF

FROM UF_F_CPPS A INNER JOIN UFDL_PWCBA_DATA.uf_d_acad_plan B

ON (A.ACAD_PLAN = B.ACAD_PLAN_CD
AND A.ACAD_CAR_SID =8)
)

CREATE TABLE UF_R3_PROG_STA0719 AS(
select 
distinct
A.PERSON_SID,
A.ACAD_PROG,
A.ACAD_PLAN,
B.ACAD_PLAN_TYPE_LD,
(SELECT MAX(B_ED.PROG_STATUS_SID) 
	FROM UF_F_CPPS B_ED 
		WHERE A.PERSON_SID = B_ED.PERSON_SID                
     		  AND A.ACAD_PLAN = B_ED.ACAD_PLAN) as MAXSTATUS,
(SELECT MAX(B_ED.EFFDT_SID) 
	FROM UF_F_CPPS B_ED 
		WHERE A.PERSON_SID = B_ED.PERSON_SID                
     		  AND A.ACAD_PLAN = B_ED.ACAD_PLAN) as MAXEFF,
(SELECT MIN(B_ED.EFFDT_SID) 
	FROM UF_F_CPPS B_ED 
		WHERE A.PERSON_SID = B_ED.PERSON_SID                
     		  AND A.ACAD_PLAN = B_ED.ACAD_PLAN) AS MINEFF

FROM UF_F_CPPS A INNER JOIN UFDL_PWCBA_DATA.uf_d_acad_plan B

ON (A.ACAD_PLAN = B.ACAD_PLAN_CD
AND A.ACAD_CAR_SID =8)
)

CREATE TABLE UF_R3_PROG_STAV20719 AS(
SELECT 
A.PERSON_SID,
A.ACAD_PROG,
A.ACAD_PLAN,
A.ACAD_PLAN_TYPE_LD,
A.MAXSTATUS,
(case when A.MAXSTATUS = 4 then (1)
else (0)
end)AS "SUCCESS_GRADUATES",
A.MAXEFF,
A.MINEFF,
(CASE WHEN substr(A.MAXEFF,-4)<=0508 THEN (substr(A.MAXEFF,0,4)||'01')
WHEN substr(A.MAXEFF,-4)>0508 AND substr(A.MAXEFF,-4)<0819 THEN (substr(A.MAXEFF,0,4)||'05')
WHEN substr(A.MAXEFF,-4)>= 0819 THEN (substr(A.MAXEFF,0,4)||'08')
END) AS BEGDATE,
(CASE WHEN substr(A.MAXEFF,-4)<=0508 THEN (substr(A.MAXEFF,0,4)||'05')
WHEN substr(A.MAXEFF,-4)>0508 AND substr(A.MAXEFF,-4)<0819 THEN (substr(A.MAXEFF,0,4)||'08')
WHEN substr(A.MAXEFF,-4)>= 0819 THEN (substr(A.MAXEFF,0,4)||'12')
END) AS ENDDATE,
(case when A.MAXSTATUS = 4 AND (A.MAXEFF - A.MINEFF) >=39900 then ('5yrs')
when A.MAXSTATUS = 4 AND (A.MAXEFF - A.MINEFF <39900) then ('4yrs') 
else ('no')
end)AS "STUDENT_SUCCESS"
FROM UF_R3_PROG_STA0719 A 
)

CREATE TABLE UF_R3_ANALYSIS_GRASUSDATE2007 AS(
SELECT distinct
A.PERSON_SID,
A.ACAD_CAR_SID,
A.INSTITUTION_SID,
A.STDNT_CAR_NBR,
A.TERM_SID,
A.STRM,
A.TERM_BEG_DT_SID,
A.TERM_END_DT_SID,
A.INSTITUTION,
A.ACAD_CAREER,
A.AGE_YEARS,
A.AGE_MONTHS,
A.AGE_DAYS,
A.TOT_CUMULATIVE,
A.JUNIOR_SENIOR_FLAG,
A.TOT_TAKEN_PRGRSS,
A.TOT_TRNSFR,
A.TOT_TEST_CREDIT,
A.TOT_OTHER,
A.TOT_PASSD_PRGRSS,
A.UNT_TAKEN_PRGRSS,
A.CUR_GPA,
A.CUM_GPA,
A.ENRL_CNT,
A.ENRL_FLG,
A.SSR_TRMAC_LAST_DT,
A.ACAD_LEVEL_BOT,
A.ACAD_LEVEL_EOT,
A.UF_CLASS,
A.RESIDENCY,
A.LASTUPD_EW_DTTM,
A.ACADEMIC_LOAD,
A.TOT_GRADE_POINTS,
A.TOT_TAKEN_GPA,
A.ENRL_SUMMER_A_FLAG,
A.ENRL_SUMMER_B_FLAG,
A.ENRL_SUMMER_C_FLAG,
A.ACAD_PROG_PRIMARY,
A.UF_CLASS_EOT,
A.UNT_TAKEN_GPA,
A.UNT_INPROG_GPA,
A.TERM_FIRST_APPT_TIME,
A.TERM_END_DT_SID_CATGRY,
A.TERM_BEG_DT_CATGRY,
A.TERM_LENGTH_CATEGORY,
A.TERM_LENGTH_DAYS,
A.TERM_SEASON,
A.LOW_TERM_GPA_IND,
A.PARTTIME_TERM_IND,
A.NOT_REG_TERM_IND,
A.WITHDRWL_TERM_IND,
A.FULLTIME_TERM_IND,
A.OVR_12HR_TERM_IND,
B.SUCCESS_GRADUATES,
B.STUDENT_SUCCESS
FROM UF_R3_SUCCESS_ANALYSIS_UDINT A 
INNER JOIN UF_R3_PROG_STAV20719 B
ON A.PERSON_SID = B.PERSON_SID
AND substr(A.TERM_BEG_DT_SID,0,6) = B.BEGDATE
AND substr(A.TERM_END_DT_SID,0,6) = B.ENDDATE
AND A.ACAD_PROG_PRIMARY = B.ACAD_PROG
AND substr(A.TERM_BEG_DT_SID,0,4) >=2007
where B.ACAD_PLAN_TYPE_LD = 'Major'
)
